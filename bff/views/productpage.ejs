<div class="microservice-layout">
    <div class="header-login">
        <div class="header-left">
            <span class="header-left_logo">
                <img src="OIP.jpg" alt="">
            </span>
            <span class="header-left_icon-homepage">
                <i class="fa-solid fa-house"></i>
            </span>
            <div class="header-left_search">
                <!-- Hoi chat gpt xem c√°i khung search n√†y template nh∆∞ n√†o-->
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" placeholder="N·ªôi dung b·∫°n mu·ªën t√¨m ki·∫øm?">
                <i class="fa-solid fa-folder-open"></i>
            </div>
            <div class="header-left_search--history">
                <div class="header-left_search--history-header">C√°c t√¨m ki·∫øm g·∫ßn ƒë√¢y</div>
                <div class="header-left_search--history-item">
                    <img src="ST.jpg" alt="st-MTP" class="header-left_search--history-icon">
                    <div class="header-left_search--history-texts">
                        <div class="header-left_search--history-title">C√† ph√™ s·ªØa</div>
                        <div class="header-left_search--history-subtitle">25.000ƒê</div>
                    </div>
                </div>
                <div class="header-left_search--history-item">
                    <img src="ST.jpg" alt="st-MTP" class="header-left_search--history-icon">
                    <div class="header-left_search--history-texts">
                        <div class="header-left_search--history-title">C√† ph√™ s·ªØa</div>
                        <div class="header-left_search--history-subtitle">25.000ƒê</div>
                    </div>
                </div>
                <button class="header-left_search--history-clear-button">Xo√° c√°c t√¨m ki·∫øm g·∫ßn ƒë√¢y</button>
            </div>
        </div>
        <% if (user) { %>
            <div class="header-right">
                <div class="header-right_menu">
                    <ul class="header-right_menu--list">
                        <li class="header-right_menu--item">Premium</li>
                        <li class="header-right_menu--item">H·ªó tr·ª£</li>
                        <li class="header-right_menu--item">T·∫£i xu·ªëng</li>
                    </ul>
                    <div class="header-right_menu_download">
                        <i class="fa-solid fa-cart-shopping"></i>
                    </div>
                </div>
                <div class="header-right_User">
                    <span class="header-right_User--noti"><i class="fa-solid fa-bell"></i></span>
                    <div class="header-right_User-box--avatar" id="avatarBtn">
                        <span class="header-right_User--avatar">N</span>
                    </div>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <div class="dropdown-item">
                            T√†i kho·∫£n <i class="fa-solid fa-up-right-from-square icon"></i>
                        </div>
                        <div class="dropdown-item selected">
                            H·ªì s∆°
                        </div>
                        <div class="dropdown-item">
                            N√¢ng c·∫•p l√™n Premium <i class="fa-solid fa-up-right-from-square icon"></i>
                        </div>
                        <div class="dropdown-item">
                            T·∫£i xu·ªëng <i class="fa-solid fa-up-right-from-square icon"></i>
                        </div>
                        <div class="dropdown-item">
                            C√†i ƒë·∫∑t
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item logout">
                            ƒêƒÉng xu·∫•t
                        </div>
                    </div>
                </div>
            </div>
            <% } else { %>
                <div class="header-right">
                    <div class="header-right_menu">
                        <ul class="header-right_menu--list">
                            <li class="header-right_menu--item">Th√¥ng tin</li>
                            <li class="header-right_menu--item">Li√™n h·ªá</li>
                            <li class="header-right_menu--item">T·∫£i xu·ªëng</li>
                        </ul>
                        <div class="header-right_menu_download">
                            <i class="fa-solid fa-right-to-bracket"></i>
                            <span class="header-right_menu_download--text">ƒêƒÉng nh·∫≠p cho Admin</span>
                        </div>
                    </div>
                    <div class="header-right_login">
                        <a class="header-right_login--signUp" href="/register">ƒêƒÉng k√Ω</a>
                        <a class="header-right_login--signIn" href="/login">ƒêƒÉng nh·∫≠p</a>
                    </div>
                </div>
                <% } %>
    </div>
    <div class="container">
        <!-- size 1/4-->
        <div class="container-sidebar">
            <div class="container-sidebar-homepageNoLogin">
                <ul class="container-sidebar-homepageNoLogin-playlist">
                    <li class="container-sidebar-homepageNoLogin-playlist--item" onclick="window.location.href='/'">
                        <div class="container-sidebar-homepageNoLogin-playlist-info">
                            <a href="/" class="container-sidebar-homepageNoLogin-playlist-title"
                                style="text-decoration: none; color: inherit;">Homepage</a>
                        </div>
                    </li>
                    <li class="container-sidebar-homepageNoLogin-playlist--item selected"
                        onclick="window.location.href='/products'">
                        <div class="container-sidebar-homepageNoLogin-playlist-info">
                            <a href="/products" class="container-sidebar-homepageNoLogin-playlist-title"
                                style="text-decoration: none; color: inherit;">Product</a>
                        </div>
                    </li>
                    <% if (user) { %>
                        <li class="container-sidebar-homepageNoLogin-playlist--item"
                            onclick="window.location.href='/cart'">
                            <div class="container-sidebar-homepageNoLogin-playlist-info">
                                <a href="/cart" class="container-sidebar-homepageNoLogin-playlist-title"
                                style="text-decoration: none; color: inherit;">Cart</a>
                            </div>
                        </li>
                        <% } %>
                </ul>
            </div>
        </div>
        <!-- size 3/4 -->
        <div class="container-box-content">

            <div class="container-box-content1">
                <!-- C√°c lo·∫°i c√† ph√™ -->
                <div class="container-box-component">
                    <div class="container-box-component--header" id="product-result-container">
                        <div class="container-box-component--header--div">
                            <span class="container-box-component--header--text">S·∫£n ph·∫©m</span>
                        </div>
                        <% if (products.length) { %>
                            <div class="slider-container">
                                <ul
                                    class="container-box-component--header--list container-box-component-product--header--list">
                                    <% products.forEach(product=> { %>
                                        <li class="container-box-component--header--item">
                                            <div class="song-thumbnail">
                                                <img src="/assets/images/products/<%= product.image %>" alt="<%= product.name %>"
                                                    class="container-box-component--header--item--img" />
                                                <span class="container-box-component--header--item--icon-play">
                                                    <i class="fa-solid fa-cart-shopping"></i>
                                                </span>
                                            </div>
                                            <span class="container-box-component--header--item--nameSong"> <%= product.name %></span>
                                            <span class="container-box-component--header--item--artist"><%= product.price %>ƒê</span>
                                        </li>
                                    <% }) %>
                                </ul>
                            </div>

                        <% } else { %>
                        <span class="container-box-component--header--no-item">Kh√¥ng c√≥ s·∫£n ph·∫©m
                            n√†o</span>
                        <% } %>
                    </div>
                </div>

                <!-- Footer -->
                <div class="container-box-footer">
                    <div class="box--list">
                        <ul class="container-box-footer--list">
                            <h3 class="container-box-footer--header3">C√¥ng ty</h3>
                            <li class="container-box-footer--item">Gi·ªõi thi·ªáu</li>
                            <li class="container-box-footer--item">Vi·ªác l√†m</li>
                            <li class="container-box-footer--item">For the Record</li>
                        </ul>
                        <ul class="container-box-footer--list">
                            <h3 class="container-box-footer--header3">C·ªông ƒë·ªìng</h3>
                            <li class="container-box-footer--item">D√†nh cho c√°c kh√°ch h√†ng</li>
                            <li class="container-box-footer--item">Nh√† Ph√°t tri·ªÉn</li>
                            <li class="container-box-footer--item">Qu·∫£ng c√°o</li>
                            <li class="container-box-footer--item">Nh√† ƒë·∫ßu t∆∞</li>
                            <li class="container-box-footer--item">Nh√† cung c·∫•p</li>

                        </ul>
                        <ul class="container-box-footer--list">
                            <h3 class="container-box-footer--header3">Li√™n k·∫øt h·ªØu √≠ch</h3>
                            <li class="container-box-footer--item">H·ªó tr·ª£</li>
                            <li class="container-box-footer--item">·ª®ng d·ª•ng di ƒë·ªông mi·ªÖn ph√≠</li>
                            <li class="container-box-footer--item">Ph·ªï bi·∫øn qu·ªëc gia</li>
                        </ul>
                        <ul class="container-box-footer--list">
                            <h3 class="container-box-footer--header3">C√°c g√≥i c·ªßa shop</h3>
                            <li class="container-box-footer--item">Premium Individual</li>
                            <li class="container-box-footer--item">Premium Student</li>
                            <li class="container-box-footer--item">Shop free</li>
                        </ul>
                    </div>
                    <div class="box--icon">
                        <span class="box--icon--span">
                            <i class="fa-brands fa-instagram"></i>
                        </span>
                        <span class="box--icon--span">
                            <i class="fa-brands fa-facebook"></i>
                        </span>
                        <span class="box--icon--span">
                            <i class="fa-brands fa-twitter"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-sidebar-right">
            <!-- Danh m·ª•c -->
            <div class="container-sidebar-right-filter">
                <h3 class="container-sidebar-right-filter-title">Danh m·ª•c</h3>
                <ul class="container-sidebar-right-filter-list" data-group="category">
                    <li class="container-sidebar-right-filter-item" data-value="C√† ph√™">C√† Ph√™</li>
                    <li class="container-sidebar-right-filter-item" data-value="N∆∞·ªõc √©p">N∆∞·ªõc √âp</li>
                    <li class="container-sidebar-right-filter-item" data-value="Tr√†">Tr√†</li>
                    <li class="container-sidebar-right-filter-item" data-value="B√°nh ng·ªçt">B√°nh Ng·ªçt</li>
                </ul>
            </div>

            <!-- Kho·∫£ng gi√° -->
            <div class="container-sidebar-right-filter">
                <h3 class="container-sidebar-right-filter-title">Kho·∫£ng gi√°</h3>
                <ul class="container-sidebar-right-filter-list" data-group="price">
                    <li class="container-sidebar-right-filter-item" data-value="<30000">D∆∞·ªõi 30.000ƒë</li>
                    <li class="container-sidebar-right-filter-item" data-value=">=30000 & <=50000">30.000ƒë - 50.000ƒë</li>
                    <li class="container-sidebar-right-filter-item" data-value=">50000">Tr√™n 50.000ƒë</li>
                </ul>
            </div>

            <!-- S·∫Øp x·∫øp theo gi√° -->
            <div class="container-sidebar-right-filter">
                <h3 class="container-sidebar-right-filter-title">S·∫Øp x·∫øp theo gi√°</h3>
                <ul class="container-sidebar-right-filter-list" data-group="sort">
                    <li class="container-sidebar-right-filter-item" data-value="asc">Th·∫•p ‚Üí Cao</li>
                    <li class="container-sidebar-right-filter-item" data-value="desc">Cao ‚Üí Th·∫•p</li>
                </ul>
            </div>

        </div>
    </div>
</div>
<script>
const filterState = {
  category: null,
  price: null,
  sort: null
};

// ‚úÖ Assign event listeners to filter items
document.querySelectorAll('.container-sidebar-right-filter-item').forEach(item => {
    item.addEventListener('click', () => {
        const group = item.closest('[data-group]')?.dataset.group;
        const value = item.dataset.value;

        filterState[group] = filterState[group] === value ? null : value;

        fetchFilteredProducts(); // üîÅ Now calls correctly
    });
});

// ‚úÖ Fetch filtered products from backend
function fetchFilteredProducts() {
    const cleanParams = {};
    for (const key in filterState) {
        if (filterState[key] !== null) {
        cleanParams[key] = filterState[key];
        }
    }
    const query = new URLSearchParams(cleanParams).toString();

    fetch(`/products/json?${query}`)
        .then(res => res.json())
        .then(products => {
            renderProducts(products);
        })
        .catch(err => {
            console.error('Failed to fetch products', err);
        });
}

// ‚úÖ Render products or show empty message
function renderProducts(products) {
    const container = document.getElementById('product-result-container');

    // Remove all children after the first one (keep the header)
    while (container.children.length > 1) {
        container.removeChild(container.lastChild);
    }

    if (!products.length) {
        const noItem = document.createElement('span');
        noItem.className = 'container-box-component--header--no-item';
        noItem.textContent = 'Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o';
        container.appendChild(noItem);
        return;
    }

    const sliderContainer = document.createElement('div');
    sliderContainer.className = 'slider-container';

    const ul = document.createElement('ul');
    ul.className = 'container-box-component--header--list container-box-component-product--header--list';

    products.forEach(product => {
        const li = document.createElement('li');
        li.className = 'container-box-component--header--item';

        li.innerHTML = `
            <div class="song-thumbnail">
                <img src="/assets/images/products/${product.image}" alt="${product.name}"
                     class="container-box-component--header--item--img" />
                <span class="container-box-component--header--item--icon-play">
                  <i class="fa-solid fa-cart-shopping"></i>
                </span>
            </div>
            <span class="container-box-component--header--item--nameSong">${product.name}</span>
            <span class="container-box-component--header--item--artist">${product.price}ƒê</span>
        `;

        ul.appendChild(li);
    });

    sliderContainer.appendChild(ul);
    container.appendChild(sliderContainer);
}
</script>